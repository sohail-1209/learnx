<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Teaching Listing - LearnX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <style>
    html {
      scroll-behavior: smooth;
    }
    
    /* Custom form styles */
    input, textarea, select {
      background-color: #2d2d2d;
      border: 1px solid #3d3d3d;
      color: white;
      transition: border-color 0.3s ease;
    }
    
    input:focus, textarea:focus, select:focus {
      border-color: #00bfa6;
      outline: none;
    }
    
    .form-label {
      margin-bottom: 0.5rem;
      display: block;
      font-weight: 500;
    }
    
    button[type="submit"] {
      transition: all 0.3s ease;
    }
    
    button[type="submit"]:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 191, 166, 0.4);
    }
  </style>
</head>
<body class="bg-[#121212] text-white font-sans">

  <!-- Sidebar Navigation -->
  <div class="flex">
    <div class="w-64 bg-[#1f1f1f] p-6 h-screen fixed top-0 left-0">
      <div class="flex flex-col space-y-6">
        <a href="index.html" class="text-2xl font-semibold text-[#00bfa6] hover:text-[#009e8d] transition-colors">LearnX</a>
        <ul class="flex flex-col space-y-4">
          <li><a href="teach.html" class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Teach</a></li>
          <li><a href="learn.html" class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Learn</a></li>
          <li><a href="profile.html" class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Profile</a></li>
          <li><a href="dashboard.html" class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Dashboard</a></li>
          <li><a href="chat.html" class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Chat</a></li>
          <li><a href="settings.html" class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Settings</a></li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 ml-64 p-8">
      <h2 class="text-3xl md:text-4xl font-semibold mb-6" data-aos="fade-up">Create a Teaching Listing</h2>
      
      <div class="bg-[#1f1f1f] p-6 rounded-lg shadow-lg mb-8" data-aos="fade-up">
        <p class="mb-6 text-gray-300">Share your expertise with others. Fill out the form below to create a teaching session.</p>
        
        <form id="create-listing-form" class="space-y-6">
          <!-- Title -->
          <div>
            <label for="title" class="form-label">Session Title</label>
            <input type="text" id="title" name="title" class="w-full p-3 rounded-lg" placeholder="E.g., JavaScript for Beginners" required />
          </div>
          
          <!-- Description -->
          <div>
            <label for="description" class="form-label">Description</label>
            <textarea id="description" name="description" rows="4" class="w-full p-3 rounded-lg" placeholder="Describe what students will learn in this session..." required></textarea>
          </div>
          
          <!-- Category -->
          <div>
            <label for="category" class="form-label">Category</label>
            <select id="category" name="category" class="w-full p-3 rounded-lg" required>
              <option value="" disabled selected>Select a category</option>
              <option value="Coding">Coding</option>
              <option value="Design">Design</option>
              <option value="Music">Music</option>
              <option value="Fitness">Fitness</option>
              <option value="Business">Business</option>
              <option value="Language">Language</option>
              <option value="Other">Other</option>
            </select>
          </div>
          
          <!-- Price -->
          <div>
            <label for="price" class="form-label">Price ($ per hour)</label>
            <input type="number" id="price" name="price" min="1" step="1" class="w-full p-3 rounded-lg" placeholder="25" required />
          </div>
          
          <!-- Duration -->
          <div>
            <label for="duration" class="form-label">Duration (minutes)</label>
            <select id="duration" name="duration" class="w-full p-3 rounded-lg" required>
              <option value="" disabled selected>Select duration</option>
              <option value="30">30 minutes</option>
              <option value="60">60 minutes</option>
              <option value="90">90 minutes</option>
              <option value="120">120 minutes</option>
            </select>
          </div>
          
          <!-- Schedule -->
          <div>
            <label for="schedule" class="form-label">Schedule Date and Time</label>
            <input type="datetime-local" id="schedule" name="schedule" class="w-full p-3 rounded-lg" required />
          </div>
          
          <!-- Max Students -->
          <div>
            <label for="max_students" class="form-label">Maximum Students</label>
            <input type="number" id="max_students" name="max_students" min="1" max="20" class="w-full p-3 rounded-lg" placeholder="10" required />
          </div>
          
          <!-- Submit Button -->
          <div class="pt-4">
            <button type="submit" class="bg-[#00bfa6] text-white py-3 px-8 rounded-lg hover:bg-[#009e8d] transition-colors font-semibold w-full md:w-auto">
              Create Session
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-[#1f1f1f] py-6 text-center text-white mt-8">
    <p>&copy; 2025 LearnX - All Rights Reserved</p>
  </footer>

  <!-- AOS Animation Init -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true
    });
  </script>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Set minimum date for schedule to today
      const today = new Date();
      const isoDate = new Date(today.getTime() - today.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
      document.getElementById('schedule').min = isoDate;
      
      // Get the token from localStorage
      const token = localStorage.getItem('token');
      
      if (!token) {
        console.log("User not logged in.");
        window.location.href = 'login.html'; // Redirect to login page
        return;
      }
      
      // Check for URL parameters (e.g., category)
      const urlParams = new URLSearchParams(window.location.search);
      const category = urlParams.get('category');
      
      // If category is provided in URL, pre-select it
      if (category) {
        const categorySelect = document.getElementById('category');
        for(let i = 0; i < categorySelect.options.length; i++) {
          if (categorySelect.options[i].value.toLowerCase() === category.toLowerCase()) {
            categorySelect.selectedIndex = i;
            break;
          }
        }
      }
      
      // Handle form submission
      document.getElementById('create-listing-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalBtnText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = 'Creating session...';
        
        // Get form data
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const category = document.getElementById('category').value;
        const price = document.getElementById('price').value;
        const duration = document.getElementById('duration').value;
        const schedule = document.getElementById('schedule').value;
        const maxStudents = document.getElementById('max_students').value;
        
        // Parse the token to get userId
        const payload = JSON.parse(atob(token.split('.')[1]));
        const userId = payload.userId;
        
        // Create payload for debugging
        const requestPayload = {
          userId: userId,
          title: title,
          description: description,
          category: category,
          price: Number(price),
          duration: Number(duration),
          schedule: schedule,
          maxStudents: Number(maxStudents)
        };
        
        console.log('Sending request to create teaching session with payload:', requestPayload);
        
        try {
          // Submit the form data
          const response = await fetch('http://127.0.0.1:5000/api/teach/create-session', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify(requestPayload)
          });
          
          // Reset button state
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalBtnText;
          
          console.log('Response status:', response.status);
          
          // Check response status
          if (!response.ok) {
            // Try to get response text
            const responseText = await response.text();
            console.log('Error response text:', responseText);
            
            // Try to parse as JSON if possible
            let errorMessage = `Failed to create session: ${response.status}`;
            try {
              // Only try to parse if it looks like JSON
              if (responseText.trim().startsWith('{')) {
                const errorData = JSON.parse(responseText);
                errorMessage = errorData.error || errorMessage;
              } else {
                errorMessage = `API Error (${response.status}): Not a valid JSON response`;
              }
            } catch (parseError) {
              console.error('Error parsing response:', parseError);
              errorMessage = `API Error (${response.status}): ${responseText.substring(0, 100)}...`;
            }
            
            throw new Error(errorMessage);
          }
          
          // Try to parse the success response
          let result;
          try {
            const responseText = await response.text();
            console.log('Success response text:', responseText);
            
            if (responseText.trim()) {
              result = JSON.parse(responseText);
            } else {
              result = { success: true };
            }
          } catch (parseError) {
            console.error('Error parsing success response:', parseError);
            throw new Error('Invalid response format from server');
          }
          
          // Show success message
          const successMessage = document.createElement('div');
          successMessage.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50';
          successMessage.innerHTML = `
            <div class="flex items-center">
              <span class="mr-2">✓</span>
              <span>Teaching session created successfully! Redirecting to teach page...</span>
            </div>
          `;
          document.body.appendChild(successMessage);
          
          // Remove the message after 3 seconds and redirect
          setTimeout(() => {
            successMessage.remove();
            // Redirect to teach page
            window.location.href = 'teach.html';
          }, 2000);
        } catch (error) {
          console.error('Error creating teaching session:', error);
          
          // Show error message
          const errorMessage = document.createElement('div');
          errorMessage.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50';
          errorMessage.innerHTML = `
            <div class="flex items-center">
              <span class="mr-2">⚠️</span>
              <span>${error.message}</span>
            </div>
          `;
          document.body.appendChild(errorMessage);
          
          // Remove the message after 5 seconds
          setTimeout(() => {
            errorMessage.remove();
          }, 5000);
        }
      });
    });
  </script>
</body>
</html> 