<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - LearnX</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body class="bg-[#121212] text-white font-sans">

  <!-- Sidebar Navigation -->
  <div class="flex">
    <div class="w-64 bg-[#1f1f1f] p-6 h-screen fixed top-0 left-0">
      <div class="flex flex-col space-y-6">
        <a href="#" class="text-2xl font-semibold text-[#00bfa6] hover:text-[#009e8d] transition-colors">LearnX</a>
        <ul class="flex flex-col space-y-4">
          <li><a href=teach.html class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Teach</a></li>
          <li><a href=learn.html class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Learn</a></li>
          <li><a href=profile.html class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Profile</a></li>
          <li><a href=chat.html class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Chat</a></li>
 <li><a href=settings.html class="hover:text-[#00bfa6] hover:scale-105 transition-transform">Settings</a></li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 ml-64 p-8">
      <h2 class="text-3xl md:text-4xl font-semibold mb-6" data-aos="fade-up">Welcome to Your Dashboard</h2>

 <!-- Notifications -->
      <div class="bg-[#1f1f1f] rounded-lg p-6 mb-8 shadow-lg" data-aos="fade-up">
        <h3 class="text-xl font-semibold mb-4">Latest Notifications</h3>
        <ul id="notifications">
          <!-- Notifications will be populated here by JavaScript -->
          <li class="mb-2">New learning opportunity: Python Bootcamp starting soon! <span class="text-[#00bfa6]">Join now</span></li>
          <li class="mb-2">You have a new message from a potential mentor.</li>
          <li>Reminder: Your next mentoring session is scheduled for tomorrow at 10:00 AM.</li>
        </ul>
      </div>

 <!-- Progress Tracking -->
      <div id="course-progress" class="bg-[#1f1f1f] rounded-lg p-6 mb-8 shadow-lg" data-aos="fade-up">
        <h3 class="text-xl font-semibold mb-4">Your Progress</h3>
        <!-- Course progress will be populated here by JavaScript -->
        <div class="flex items-center justify-between mb-2">
          <p class="text-lg">JavaScript Fundamentals</p>
          <div class="w-1/2 bg-[#2d2d2d] rounded-full h-4">
 <div class="bg-[#00bfa6] h-4 rounded-full" style="width: 75%"></div>
          </div>
          <span class="text-[#00bfa6]">75%</span>
        </div>
        <div class="flex items-center justify-between">
          <p class="text-lg">UI/UX Design Principles</p>
          <div class="w-1/2 bg-[#2d2d2d] rounded-full h-4">
 <div class="bg-[#00bfa6] h-4 rounded-full" style="width: 40%"></div>
          </div>
          <span class="text-[#00bfa6]">40%</span>
        </div>
      </div>

 <!-- User Stats -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div id="user-skills" class="bg-[#1f1f1f] p-6 rounded-lg shadow-lg" data-aos="fade-up">
          <h3 class="text-xl font-semibold mb-4">Your Skills</h3>
          <ul id="skills-list">
            <!-- Skills will be populated here by JavaScript -->
            <li>Python Programming</li>
            <li>Web Development</li>
            <li>Data Science</li>
          </ul>
        </div>
        <div id="ongoing-sessions" class="bg-[#1f1f1f] p-6 rounded-lg shadow-lg" data-aos="fade-up">
          <h3 class="text-xl font-semibold mb-4">Ongoing Sessions</h3>
 <ul id="sessions-list">
            <!-- Ongoing sessions will be populated here by JavaScript -->
 <li>Mentoring session with Jane (Web Development) - 3:00 PM</li>
            <li>Learning session on Python - 5:00 PM</li>
          </ul>
        </div>
      </div>

 <!-- Quick Actions -->
      <div class="bg-[#1f1f1f] p-6 rounded-lg shadow-lg mb-8" data-aos="fade-up">
        <h3 class="text-xl font-semibold mb-4">Quick Actions</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <a href="learn.html" class="bg-[#00bfa6] text-white text-center py-3 px-4 rounded-lg hover:bg-[#009e8d] transition-colors">Find Mentor</a>
          <a href="teach.html" class="bg-[#00bfa6] text-white text-center py-3 px-4 rounded-lg hover:bg-[#009e8d] transition-colors">Offer Mentorship</a>
          <a href="schedule.html" class="bg-[#00bfa6] text-white text-center py-3 px-4 rounded-lg hover:bg-[#009e8d] transition-colors">View Schedule</a>
          <a href="chat.html" class="bg-[#00bfa6] text-white text-center py-3 px-4 rounded-lg hover:bg-[#009e8d] transition-colors">Messages</a>
        </div>
      </div>
 <!-- Upcoming Opportunities -->
      <div id="upcoming-opportunities" class="bg-[#1f1f1f] p-6 rounded-lg rounded-lg shadow-lg mt-8" data-aos="fade-up">
        <h3 class="text-xl font-semibold mb-4">Upcoming Opportunities</h3>
        <ul id="opportunities-list">
          <!-- Upcoming opportunities will be populated here by JavaScript -->
          <li>Join a group study for "Introduction to Machine Learning" - 15th May</li>
          <li>Becoming a mentor for beginner web developers - Apply by 18th May</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-[#1f1f1f] py-6 text-center text-white mt-8">
    <p>&copy; 2025 LearnX - All Rights Reserved</p>
  </footer>

  <!-- AOS Animation Init -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'login.html'; // Redirect to login if no token
        return;
      }

      const payload = JSON.parse(atob(token.split('.')[1]));
      const userId = payload.userId;

      async function fetchDashboardData(userId) {
        console.log("Fetching dashboard data for user ID:", userId);
        try {
          const response = await fetch(`http://127.0.0.1:5000/api/dashboard/${userId}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          console.log("API response status:", response.status);
          if (!response.ok) {
            const errorText = await response.text();
            console.error("API error response:", errorText);
            throw new Error(`Failed to fetch dashboard data: ${response.status} ${errorText}`);
          }
          const data = await response.json();
          console.log("API response data:", data);
          return data;
        } catch (error) {
          console.error("Error in fetchDashboardData:", error);
          throw error;
        }
      }

      // Function to display dashboard data
      function displayDashboardData(userData) {
        console.log("Dashboard data received:", userData); // Add this for debugging
        
        // Clear the placeholders
        document.getElementById('notifications').innerHTML = '';
        document.getElementById('course-progress').innerHTML = '<h3 class="text-xl font-semibold mb-4">Your Progress</h3>';
        document.getElementById('skills-list').innerHTML = '';
        
        // Display notifications
        if (userData.notifications && userData.notifications.length > 0) {
          document.getElementById('notifications').innerHTML = userData.notifications.map(notification => 
            `<li class="mb-2">${notification}</li>`
          ).join('');
        } else {
          document.getElementById('notifications').innerHTML = '<li>No notifications yet.</li>';
        }
        
        // Display course progress
        if (userData.courseProgress && userData.courseProgress.length > 0) {
          const progressHTML = userData.courseProgress.map(course => 
            `<div class="flex items-center justify-between mb-2">
              <p class="text-lg">${course.course_name}</p>
              <div class="w-1/2 bg-[#2d2d2d] rounded-full h-4">
                <div class="bg-[#00bfa6] h-4 rounded-full" style="width: ${course.progress}%"></div>
              </div>
              <span class="text-[#00bfa6]">${course.progress}%</span>
            </div>`
          ).join('');
          document.getElementById('course-progress').innerHTML += progressHTML;
        } else {
          document.getElementById('course-progress').innerHTML += '<p>No courses in progress.</p>';
        }
        
        // Display skills
        if (userData.skills && userData.skills.length > 0) {
          document.getElementById('skills-list').innerHTML = userData.skills.map(skill => 
            `<li class="mb-2 py-2 px-4 bg-[#1f1f1f] rounded">${skill}</li>`
          ).join('');
          console.log("Skills displayed:", userData.skills);
        } else {
          document.getElementById('skills-list').innerHTML = '<li class="mb-2 py-2 px-4 bg-[#1f1f1f] rounded text-gray-400">No skills added yet.</li>';
          console.log("No skills found in userData or empty array");
        }
      }

      // Fetch and display data when the page loads
      fetchDashboardData(userId)
        .then(data => {
          displayDashboardData(data);
        })
        .catch(error => {
          console.error('Error fetching dashboard data:', error);
          // Display error message on the page
          document.getElementById('notifications').innerHTML = '<li class="text-red-500">Error loading notifications. Please try again later.</li>';
          document.getElementById('course-progress').innerHTML = '<h3 class="text-xl font-semibold mb-4">Your Progress</h3><p class="text-red-500">Error loading course progress. Please try again later.</p>';
          document.getElementById('skills-list').innerHTML = '<li class="text-red-500">Error loading skills. Please try again later.</li>';
        });
    });
  </script>
</body>
</html>
